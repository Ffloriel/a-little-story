var n,i;n=512,i=0,vizualizer.init("audio1",n),vizualizer.initBars(100),vizualizer.initStars(n),vizualizer.initText("Happy Birthday"),vizualizer.initCircle();var secondToFrame=function(t){"use strict";return 60*t};i=0,document.getElementById("audio1").addEventListener("ended",function(){"use strict";vizualizer.changeAudio("audio/12%20little%20star.mp3"),vizualizer.audioElement.play(),document.getElementById("audio1").addEventListener("ended",function(){vizualizer.text.text("The End ♥"),vizualizer.stop()},!1)},!1);var renderFunction=function(){"use strict";setTimeout(function(){requestAnimationFrame(this.renderFunction),1===i?this.createMainCharacter():i===secondToFrame(3)?this.man.speech.text("J'ai fait une petite scène :)"):i===secondToFrame(7)?this.man.speech.text("Regarde la avec le navigateur chrome"):i===secondToFrame(11)?this.man.speech.text("Mets en pleine écran avec F11 puis recharge la page avec F5"):i===secondToFrame(18)?this.man.speech.text("Prête ? J'y vais!"):i===secondToFrame(20)?this.getReadyMan():i===secondToFrame(28)?(this.audioElement.play(),this.audioElement.volume=.5,this.man.speech.attr("font-size",60),this.man.speech.text("A Little Story")):i===secondToFrame(32)?(this.fadeManSpeech(1e3),this.startMainCharacter()):i===secondToFrame(38)?this.releaseHeart():i===secondToFrame(60)?(this.svg.style("background-color","#000"),this.blackHeart.remove(),this.man.head.attr("transform",null),this.man.body.attr("transform",null),this.man.leftEye.attr("opacity",1).attr("transform",null),this.man.rightEye.attr("transform",null),this.man.smile.attr("transform",null),this.man.speech.attr("fill","white").attr("opacity",1),this.man.speech.text(" ")):i===secondToFrame(69)?this.releaseCircles():i===secondToFrame(100)?(this.circles.remove(),this.circle.remove()):i===secondToFrame(116)?this.fadeMan():i===secondToFrame(130)?this.releaseColorSquare():i===secondToFrame(142)?this.startColorSquareBoom():i===secondToFrame(185)?this.bars.transition().attr("opacity","0").duration(5e3).ease("linear"):i===secondToFrame(61)?this.man.speech.text("I am like a god"):i===secondToFrame(64)?this.man.speech.text("Who can create everything"):i===secondToFrame(68)?this.man.speech.text("The shadow of a planet"):i===secondToFrame(72)?this.man.speech.text("Is a beautiful thing"):i===secondToFrame(76)?this.man.speech.text("But I am feeling odd"):i===secondToFrame(79)?this.man.speech.text("Maybe I am not ready yet"):i===secondToFrame(83)?this.man.speech.text("To create something"):i===secondToFrame(86)?this.man.speech.text("That will be perfect"):i===secondToFrame(89)?(this.man.smile.attr("points",this.smile[0][0]+","+this.smile[0][1]+" "+this.smile[1][0]+","+this.smile[1][1]+" "+this.smile[2][0]+","+this.smile[2][1]+" "+this.smile[3][0]+","+this.smile[3][1]),this.man.speech.text("Nothing will stop me")):i===secondToFrame(92)?this.man.speech.text("I will transform the sky"):i===secondToFrame(95)?this.man.speech.text("I hope you are ready"):i===secondToFrame(98)?this.man.speech.text("I am prepared to try"):i===secondToFrame(103)?this.man.speech.text("Twinkle Twinkle Little Star"):i===secondToFrame(107)?this.man.speech.text("The stronger the music is"):i===secondToFrame(110)?this.man.speech.text("The brighter you are"):i===secondToFrame(114)?this.fadeManSpeech(1e3):i===secondToFrame(163)?this.appearMan(1e3):i===secondToFrame(165)?(this.man.speech.attr("opacity",1),this.man.speech.text("See you soon")):i===secondToFrame(170)&&(this.fadeManSpeech(1e3),this.fadeMan(1e3)),i>=secondToFrame(76)&&i<secondToFrame(100)?this.renderCircle():i>=secondToFrame(115)&&i<secondToFrame(145)?this.renderStars():i>=secondToFrame(144.5)&&i<secondToFrame(185)?this.renderBars():i>=secondToFrame(185)&&(this.renderStars(),this.renderText()),i+=1}.bind(this),1e3/60)}.bind(vizualizer);vizualizer.setRenderFunction(renderFunction),vizualizer.start();var vizualizer={audioElement:0,audioSrc:0,audioContext:0,analyser:0,frequencyData:0,init:function(t,i){"use strict";if("undefined"!=typeof AudioContext)this.audioContext=new AudioContext;else{if("undefined"==typeof webkitAudioContext)throw new Error("AudioContext not supported. :(");this.audioContext=new webkitAudioContext}this.audioElement=document.getElementById(t),this.audioSrc=this.audioContext.createMediaElementSource(this.audioElement),this.analyser=this.audioContext.createAnalyser(),this.audioSrc.connect(this.analyser),this.audioSrc.connect(this.audioContext.destination),this.dataArray=new Uint8Array(i),this.frequencyData=this.analyser.getByteFrequencyData(this.dataArray),this.width=document.getElementsByTagName("body")[0].clientWidth,this.height=document.getElementsByTagName("body")[0].clientHeight,this.svg=d3.select("body").append("svg").attr("width",this.width).attr("height",this.height)},initBars:function(t){"use strict";this.barNumber=t,this.bars=this.svg.selectAll("rect").data(this.dataArray).enter().append("rect"),this.bars.attr("width",this.width/this.barNumber).attr("y",this.height/2).attr("x",function(t,i){return this.width/this.barNumber*i}.bind(this)).attr("style","fill:#000;")},setAttributeBars:function(t,i){"use strict";this.bars.attr(t,i)},renderBars:function(){"use strict";this.analyser.getByteFrequencyData(this.dataArray),this.bars.data(this.dataArray).attr("height",function(t){return 1+.5*this.height*t/255}.bind(this)).attr("style",function(t){return"fill: rgb(125,"+(255-t)+","+t+");"})},initStars:function(t){"use strict";this.starsNumber=t,this.stars=this.svg.selectAll("circle").data(this.dataArray).enter().append("circle"),this.stars.attr("cx",function(){return Math.random()*this.width}.bind(this)).attr("cy",function(){return Math.random()*this.height}.bind(this)).attr("fill","#fff")},setAttributeStars:function(t,i){"use strict";this.stars.attr(t,i)},renderStars:function(){"use strict";this.analyser.getByteFrequencyData(this.dataArray),this.stars.data(this.dataArray).attr("style",function(t){return"opacity:"+t/255+";"}).attr("r",function(t){return t/255*10})},initText:function(t,i,a){"use strict";"undefined"==typeof a&&(a=this.width/2),"undefined"==typeof i&&(i=this.height/2),this.text=this.svg.append("text").data(this.dataArray).text(t).attr("font-size",0).attr("fill","#fff").attr("opacity","0.7").attr("text-anchor","middle").attr("x",a).attr("y",i)},setAttributeText:function(t,i){"use strict";this.text.attr(t,i)},renderText:function(){"use strict";this.analyser.getByteFrequencyData(this.dataArray),this.text.data(this.dataArray).attr("font-size",50+.5*d3.mean(this.dataArray)*this.height/255)},initCircle:function(){"use strict";this.circle=this.svg.append("circle").data(this.dataArray).attr("cx",this.width/2).attr("cy",this.height/2).attr("stroke-width",2).attr("stroke","#fff").attr("fill","none").attr("opacity","0.7")},setAttributeCircle:function(t,i){"use strict";this.circle.attr(t,i)},renderCircle:function(){"use strict";this.analyser.getByteFrequencyData(this.dataArray),this.circle.data(this.dataArray).attr("r",150+.5*d3.mean(this.dataArray)*this.height/255)},initImage:function(t,i,a,e,r){"use strict";"undefined"==typeof i&&(i=this.width/2),"undefined"==typeof a&&(a=this.height/2),"undefined"==typeof e&&(e=this.width/4),"undefined"==typeof r&&(r=this.height/4),this.image=this.svg.append("image").data(this.dataArray).attr("x",e).attr("y",r).attr("width",i).attr("height",a).attr("xlink:href",t).attr("preserveAspectRatio","xMidYMid slice"),this.image.x=e,this.image.y=r,this.image.width=i,this.image.height=a},setAttributeImage:function(t,i){"use strict";this.image.attr(t,i)},renderImage:function(){"use strict";var t;t=1+d3.mean(this.dataArray)/255,this.analyser.getByteFrequencyData(this.dataArray),this.image.data(this.dataArray).attr("transform","scale("+t+")").attr("x",this.image.x-(this.image.width*t-this.image.width)/t).attr("y",this.image.y-(this.image.height*t-this.image.height)/t)},changeAudio:function(t){"use strict";this.audioElement.setAttribute("src",t)},start:function(){"use strict";requestAnimationFrame(this.renderFunction)},stop:function(){"use strict";this.audioElement.pause()},setRenderFunction:function(t){"use strict";this.renderFunction=t},releaseHeart:function(){"use strict";this.heart=this.svg.selectAll("image").data(this.dataArray).enter().append("image").attr("x",this.width-175).attr("y",this.height-100).attr("width",25).attr("height",25).attr("xlink:href","img/heart.svg").attr("preserveAspectRatio","xMidYMid slice").attr("fill","#fff").transition().attr("x",function(){return 2e3*Math.random()-1e3}).attr("y",function(){return 1e3*-Math.random()-30}).duration(1e4).delay(function(t,i){return i/896*1e4}),this.blackHeart=this.svg.append("image").attr("width",25).attr("height",25).attr("x",this.width-175).attr("y",this.height-100).attr("opacity",0).attr("xlink:href","img/blackHeart.svg"),this.blackHeart.transition().attr("x",this.width/2).attr("y",this.height/2).attr("opacity",1).duration(1e4).delay(7e3).transition().attr("x",-this.width/2*4).attr("y",-this.height/2*4).attr("width",5*this.width).attr("height",5*this.height).duration(5e3)},releaseCircles:function(){"use strict";var t,i;t=0,i=150+127.5*this.height/255,this.circles=this.svg.append("circle").attr("cx",this.width/2).attr("cy",this.height/2).attr("stroke-width",2).attr("stroke","#fff").attr("fill","none").attr("opacity","0").attr("r",50),this.circles.transition().attr("opacity",1).duration(5e3).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(100).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500).transition().attr("r",50).attr("opacity",1).duration(10).transition().attr("opacity",0).attr("r",i).duration(500)},releaseColorSquare:function(){"use strict";this.colorSquare=this.svg.append("rect").attr("x",this.width+150).attr("y",this.height/2-100).attr("height",100).attr("width",100).attr("fill","#7E45E8"),this.colorSquare.transition().attr("x",this.width/2+100).duration(1e4)},changeColorSquareColor:function(t,i){"use strict";this.colorSquare.transition().style("fill",t).duration(i)},startColorSquareBoom:function(){"use strict";this.colorSquare.transition().style("fill","#9FFF6D").attr("y",this.height/2-125).duration(1e3).ease("linear").transition().style("fill","#7E45E8").attr("y",this.height/2-150).duration(800).ease("linear").transition().style("fill","#B0FFAD").attr("y",this.height/2-175).duration(800).ease("linear").transition().style("fill","#6D60E8").attr("y",this.height/2-210).duration(800).ease("linear").transition().style("fill","#9FFF6D").attr("y",this.height/2-160).duration(500).ease("linear").transition().style("fill","#7E45E8").attr("y",this.height/2-100).ease("linear").duration(400).transition().attr("opacity",0).duration(500)},createMainCharacter:function(){"use strict";var t;this.man={},this.man.headXpos=this.width/2,this.man.headYpos=this.height/2-100,this.man.head=this.svg.append("circle").attr("r",20).attr("stroke","#000").attr("stroke-width",2).attr("fill","#f0f0f0").attr("cx",this.width/2).attr("cy",this.height/2-100),this.man.leftEye=this.svg.append("circle").attr("r",2).attr("stroke","#000").attr("stroke-width",2).attr("fill","#000").attr("cx",this.width/2+6).attr("cy",this.height/2-105),this.man.rightEye=this.svg.append("circle").attr("r",2).attr("stroke","#000").attr("stroke-width",2).attr("fill","#000").attr("cx",this.width/2-6).attr("cy",this.height/2-105),this.smile=[[this.width/2-8,this.height/2-93],[this.width/2-2,this.height/2-90],[this.width/2+2,this.height/2-90],[this.width/2+8,this.height/2-93]],t=this.smile[0][0]+","+this.smile[0][1],t+=" "+this.smile[1][0]+","+this.smile[1][1],t+=" "+this.smile[2][0]+","+this.smile[2][1],t+=" "+this.smile[3][0]+","+this.smile[3][1],this.man.smile=this.svg.append("polyline").attr("stroke-width",2).attr("stroke","#000").attr("fill","none").attr("points",t),this.man.speech=this.svg.append("text").text("Auréa! C'est moi!").attr("font-size",40).attr("fill","#000").attr("opacity","1").attr("text-anchor","middle").attr("x",this.width/2-50).attr("y",this.height/2-150),this.man.body=this.svg.append("rect").attr("x",this.width/2-25).attr("y",this.height/2-70).attr("width",50).attr("height",70).attr("stroke","#000").attr("stroke-width",2).attr("fill","#f0f0f0")},fadeManSpeech:function(t){"use strict";this.man.speech.transition().attr("opacity","0").duration(t)},fadeMan:function(t){"use strict";this.man.head.transition().attr("opacity","0").duration(t),this.man.body.transition().attr("opacity","0").duration(t),this.man.smile.transition().attr("opacity","0").duration(t),this.man.leftEye.transition().attr("opacity","0").duration(t),this.man.rightEye.transition().attr("opacity","0").duration(t)},appearMan:function(t){"use strict";this.man.head.transition().attr("opacity","1").duration(t),this.man.body.transition().attr("opacity","1").duration(t),this.man.smile.transition().attr("opacity","1").duration(t),this.man.leftEye.transition().attr("opacity","1").duration(t),this.man.rightEye.transition().attr("opacity","1").duration(t)},getReadyMan:function(){"use strict";this.man.head.transition().attr("transform","translate(50, 0)").duration(1e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos-50)+","+(this.height-this.man.headYpos-100)+")").duration(6e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos+25)+","+(this.height-this.man.headYpos-100)+")").duration(1e3).ease("linear"),this.man.rightEye.transition().attr("transform","translate(65, 0)").duration(1e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos-35)+","+(this.height-this.man.headYpos-100)+")").duration(6e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos+40)+","+(this.height-this.man.headYpos-100)+")").duration(1e3).ease("linear"),this.man.leftEye.transition().attr("transform","translate(10, 0)").duration(200).ease("linear").transition().attr("opacity",0).duration(20),this.man.body.transition().attr("transform","translate(50, 0)").duration(1e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos-50)+","+(this.height-this.man.headYpos-100)+")").duration(6e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos+25)+","+(this.height-this.man.headYpos-100)+")").duration(1e3).ease("linear"),this.man.smile.transition().attr("transform","translate(65, 0)").duration(1e3).ease("linear").transition().attr("points",this.smile[0][0]+","+this.smile[0][1]+" "+this.smile[1][0]+","+this.smile[1][1]+" "+this.smile[2][0]+","+this.smile[2][1]).attr("transform","translate("+(this.width-this.man.headXpos-35)+","+(this.height-this.man.headYpos-100)+")").duration(6e3).ease("linear").transition().attr("transform","translate("+(this.width-this.man.headXpos+40)+","+(this.height-this.man.headYpos-100)+")").duration(1e3).ease("linear")},startMainCharacter:function(){"use strict";this.man.head.transition().attr("transform","translate("+(this.width-this.man.headXpos-100)+","+(this.height-this.man.headYpos-100)+")").duration(3e3).ease("linear"),this.man.rightEye.attr("transform","translate("+(this.width-this.man.headXpos+15)+","+(this.height-this.man.headYpos-100)+")").transition().attr("transform","translate("+(this.width-this.man.headXpos-105)+","+(this.height-this.man.headYpos-100)+")").duration(3e3).ease("linear"),this.man.body.transition().attr("transform","translate("+(this.width-this.man.headXpos-100)+","+(this.height-this.man.headYpos-100)+")").duration(3e3).ease("linear"),this.man.smile.attr("transform","translate("+(this.width-this.man.headXpos+7)+","+(this.height-this.man.headYpos-100)+")").attr("points",this.smile[1][0]+","+this.smile[1][1]+" "+this.smile[2][0]+","+this.smile[2][1]+" "+this.smile[3][0]+","+this.smile[3][1]).transition().attr("transform","translate("+(this.width-this.man.headXpos-113)+","+(this.height-this.man.headYpos-100)+")").duration(3e3).ease("linear")}};